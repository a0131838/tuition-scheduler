# Tuition Scheduler 员工使用手册（完整版）

更新日期：2026-02-10  
适用对象：前台顾问、教务排课、学管（课包/续费）、主管/管理者、老师  
本文目标：让“第一次用系统的同事”，按流程完成：建档 -> 课包 -> 报名/排课 -> 点名 -> 反馈 -> 对账/导出，并能处理常见异常。

---

## 0. 系统入口与术语

### 0.1 两个端口
- 管理端（运营/教务/学管/主管）：`/admin`
  - 登录：`/admin/login`
- 老师端（老师自助）：`/teacher`
  - 登录：`/admin/login` 页面点击 Teacher

### 0.2 关键对象（请按这个顺序理解）
- 校区（Campus）：线下场地/门店维度。
- 教室（Room）：属于某个校区，有容量。
- 课程体系（Course）：包含 Subject/Level 等维度；它决定“老师能教什么、学生买什么、班级是什么课”。
- 老师（Teacher）：可绑定一个系统账号；可维护可上课时间。
- 学生（Student）：基础档案 + 来源/类型；可拥有课包；可报名班级；可被安排一对一课次。
- 班级（Class）：一个长期“班课容器”，包含课程、老师、校区教室、容量、周期性课次等。
- 课次（Session）：某次具体上课（班课或一对一）。
- 报名（Enrollment）：学生加入某个班级的关系（会影响班课点名名单、导出报名表）。
- 课包（Package）：学生为某课程购买的权益（班课包/一对一时间包）；点名会自动扣减并记账。
- 预约/请求（Booking）：学生通过选课链接提交的预约请求，教务审批后可落地为课次/预约。

### 0.3 日常最重要的 3 个页面
- `待办中心`：`/admin/todos`（每天开工第一站）
- `周课表`：`/admin/schedule`（排课/改课主战场）
- `冲突处理中心`：`/admin/conflicts`（所有冲突在这里闭环，不要靠“猜”）

---

## 1. 角色与权限（必须先对齐）

### 1.1 角色说明（系统内）
- `ADMIN`：可进入管理端并执行教务运营操作。
- `MANAGER`（管理者名单中的账号）：可访问管理者驾驶舱与系统用户管理。
- `OWNER MANAGER`：管理者中的最高权限（owner）。
- `TEACHER`：进入老师端；维护可上课时间、点名、课后反馈、名片。

### 1.2 当前关键权限规则（与你现网一致）
- 老师账号如果在管理者名单中，也可进入管理端。
- 系统使用者管理（`/admin/manager/users`）保护规则：
  - 普通管理者不能编辑 owner（例如 `zhao hongwei`）。
  - `manager-admin` 受保护，不可编辑。
  - owner 可维护管理者名单与关键账号治理。

### 1.3 新员工开通账号（主管/owner 必做）
建议最小权限策略：
1. 前台顾问：`ADMIN`（不进管理者模块）。
2. 教务排课：`ADMIN`（需要排课、冲突处理、点名）。
3. 学管：`ADMIN`（需要课包与对账）。
4. 主管：`ADMIN` + `MANAGER`（需要驾驶舱与用户管理）。
5. 老师：`TEACHER`（并在老师档案页绑定账号，否则老师端会看不到课次）。

---

## 2. 上线前配置（一次性搭建，按顺序）

如果这是第一天启用系统，请按下列顺序搭建基础数据，否则后续页面会出现“无可选项/无法排课”的问题：

1. 创建校区：`/admin/campuses`
2. 创建教室：`/admin/rooms`
3. 创建课程体系：`/admin/courses`
4. 创建老师：`/admin/teachers`
5. 为老师设置授课能力/模板、并绑定账号：`/admin/teachers/[id]`
6. 维护老师可上课时间（建议用模板生成整月）：`/admin/teachers/[id]/availability`
7. 创建班级（班课需要）：`/admin/classes`
8. 录入学生档案：`/admin/students`
9. 为学生创建课包：`/admin/packages`
10. 报名（班课需要）：`/admin/enrollments`
11. 开始排课：`/admin/schedule` 或 `/admin/schedule/new`

---

## 3. 员工日常工作流（按岗位，照做即可）

### 3.1 教务排课（每日开工顺序）
适用页面：`/admin/todos`、`/admin/schedule`、`/admin/schedule/new`、`/admin/conflicts`、`/admin/sessions/[id]/attendance`

1. 打开 `待办中心`：`/admin/todos`
2. 清 `昨日/今日未点名`（必须优先清零，否则扣费/报表都会滞后）
3. 看 `冲突巡检`：有冲突先去 `冲突处理中心` 闭环，再新增排课
4. 看 `明日提醒（老师/学生）`：确认/提醒到位，避免临时爽约
5. 到 `周课表` 处理改课：换老师/换教室/取消
6. 需要补加课时，用 `新建(单次)`：`/admin/schedule/new`

排课规则（硬规则）：
- 课次时间必须在老师可上课时间内（08:00-23:00）。
- 同时校验：老师冲突、教室冲突、预约冲突。
- 所有冲突统一在 `冲突处理中心` 处理，不要只在周课表上“盲改”。

点名规则（硬规则）：
- 点名保存会自动扣减课包并记录流水（可回滚/撤销）。
- `EXCUSED` 是否扣费按业务选择（请主管对齐口径）。
- 扣费异常优先查：课次点名页 + 课包流水页（ledger）。

### 3.2 学管（课包/续费）
适用页面：`/admin/packages`、`/admin/packages/[id]/ledger`、`/admin/students/[id]`、`/admin/reports/monthly-hours`

1. 每天看 `待办中心` 续费预警名单（课包余额/预计可用天数）。
2. 到学生详情核对：剩余、近期排课、历史点名。
3. 创建/更新课包，避免断课。
4. 抽查对账：课包流水是否与点名扣费一致。

关键规则（硬规则）：
- 学生可同时拥有：班课包 + 一对一时间包。
- 同一学生 + 同一课程 + 同一模式：课包有效期不能重叠。
- 无有效课包：不能报名/排课（系统会报错）。

风险信号（需要关注）：
- 课包余额快速下降但排课量未明显增加。
- 同一学生出现多包重叠异常。
- 点名状态与扣减记录不一致。

### 3.3 前台顾问（学生建档/发链接）
适用页面：`/admin/students`、`/admin/students/[id]`、`/admin/booking-links`

1. 新增学生档案（姓名、学校、年级、来源、类型）。
2. 在学生详情确认：目标课程是否已有有效课包（没有就先让学管创建）。
3. 学生需要自主约课：创建 `学生选课链接` 并发送给学生。
4. 跟进学生提交请求进度，提醒教务审批。

必查项：
- 学生是否已购买目标课程课包（否则后面无法排课/报名）。
- 选课链接日期范围、失效时间是否正确。
- 链接是否发给正确学生（不要串号）。

### 3.4 老师（老师端自助）
适用页面：`/teacher`、`/teacher/availability`、`/teacher/sessions`、`/teacher/sessions/[id]`、`/teacher/card`

1. 登录老师端，确认今日/明日课程。
2. 提前维护可上课时间（建议覆盖未来 2-4 周）。
3. 每节课后完成点名。
4. 12 小时内提交课后反馈（逾期会进入告警）。

质量要求：
- 点名准确（迟到/请假/缺勤不要误填）。
- 反馈具体（课堂表现、作业、前次作业完成）。

### 3.5 主管/管理者（风控SOP）
适用页面：`/admin/todos`、`/admin/manager`、`/admin/manager/users`

每日三段式：
1. 开工 10-15 分钟：看待办中心四个指标（今日未点名、昨日遗留未点名、冲突巡检、续费预警）。
2. 中午 5 分钟：复查点名与反馈超时趋势。
3. 收工 10 分钟：确认明日提醒、续费跟进、当天关键变更有记录。

---

## 4. 端到端流程（把业务跑通的最短路径）

### 4.1 流程A：新老师入职（教务/主管）
目标：老师能在老师端看到课次并能点名反馈。

1. 管理端创建老师：`/admin/teachers`
2. 到老师详情补全资料：`/admin/teachers/[id]`
3. 设置授课能力/一对一模板（如有）：`/admin/teachers/[id]`
4. 绑定账号：
   - “绑定已有系统用户” 或 “创建并绑定账号”
5. 生成/维护可上课时间：`/admin/teachers/[id]/availability`
6. 验收：
   - 老师用账号登录老师端：`/teacher/sessions` 能看到课次（或至少能进入页面不报错）

常见卡点：
- 老师端看不到课次：通常是“账号没绑定到老师档案”。

### 4.2 流程B：新学生入学（前台/学管/教务协作）
目标：学生可报名/可排课/可扣费。

1. 前台建档：`/admin/students`
2. 学管建课包：`/admin/packages`
3. 班课路径：
   - 教务建班：`/admin/classes`
   - 教务报名：`/admin/enrollments`
   - 教务生成课次：班级课次页或周课表
4. 一对一路径：
   - 教务在学生详情用“快速排课”安排一对一，或在 `新建(单次)` 创建预约
5. 课后：
   - 老师点名：`/teacher/sessions/[id]` 或管理端 `.../attendance`
   - 系统扣费并记账：课包 ledger 可核对

### 4.3 流程C：学生自助约课（选课链接）
目标：学生提交请求 -> 教务审批 -> 落地排课。

1. 前台/教务创建链接：`/admin/booking-links`
2. 复制链接发给学生（可设置日期范围、时长、步长、老师筛选）。
3. 学生打开链接：`/booking/[token]` 提交请求。
4. 教务到链接详情页审批：`/admin/booking-links/[id]`
5. 需要时导出该链接月历 PDF 作为对外确认材料。

---

## 5. 管理端功能说明（按菜单，逐页解释）

### 5.1 总览 `/admin`
- 用途：快速跳转 + 提示基础搭建顺序。
- 新门店上线建议先按提示建完“校区/教室/老师/课程/班级”。

### 5.2 待办中心 `/admin/todos`
你每天的“总控台”，集中呈现：
- 冲突巡检结果
- 自动修复日志（老师冲突）
- 昨日/今日未点名
- 明日提醒（老师/学生）
- 历史未点名分页
- 续费预警

强制优先级：
1. 未点名
2. 冲突
3. 明日提醒
4. 续费预警
5. 新增排课

### 5.3 签到告警 `/admin/alerts`
- 看未签到/反馈超时告警（阈值可配置）。
- 可以直达课次点名页处理。

### 5.4 基础数据
- 校区：`/admin/campuses`
  - 删除校区会级联删除大量业务数据（高风险，务必审批）。
- 教室：`/admin/rooms`
- 学生来源：`/admin/student-sources`（已被使用不能删除，只能停用）
- 学生类型：`/admin/student-types`（同上）
- 课程体系：`/admin/courses`（强依赖：老师能力、班级创建、快速排课）

### 5.5 老师
- 列表：`/admin/teachers`
  - 新增/删除老师；可进入详情绑定账号、模板、批量生成课次。
  - 可导出老师名片 PDF。
- 详情：`/admin/teachers/[id]`
  - 资料编辑、账号绑定/解绑、一对一模板、批量生成课次等。
- 可上课时间（教务维护）：`/admin/teachers/[id]/availability`
  - 支持模板生成整月；时间范围限制 08:00-23:00。
- 名片预览：`/admin/teachers/[id]/card`

### 5.6 学生
- 列表：`/admin/students`
  - 新增/筛选/删除（删除会同步删除关联报名/预约/课包，谨慎）。
- 详情：`/admin/students/[id]`
  - 编辑信息、查看课包与出勤、快速排课、导出学生课表 PDF。
  - 快速排课只显示“学生已购课程相关选项”；无有效课包会直接阻止排课。

### 5.7 排课与出勤
- 周课表：`/admin/schedule`
- 全周总览：`/admin/schedule/all`
- 新建单次：`/admin/schedule/new`
- 冲突处理中心：`/admin/conflicts`
  - 老师冲突（课次/预约重叠）
  - 教室冲突（课次重叠）
- 课次点名：`/admin/sessions/[id]/attendance`

### 5.8 班级、报名、课包
- 班级：`/admin/classes`、`/admin/classes/[id]`、`/admin/classes/[id]/sessions`
- 报名：`/admin/enrollments`
  - 学生必须有该课程有效课包才可报名。
  - 同一学生同一课程不允许重复建立报名关系（避免重复扣费/冲突）。
- 课包：`/admin/packages`、`/admin/packages/[id]/ledger`
  - ledger 支持赠送、导出对账单 PDF。

### 5.9 学生选课链接
- 列表：`/admin/booking-links`
- 详情：`/admin/booking-links/[id]`
  - 审批学生请求（通过/拒绝）
  - 导出链接月历 PDF

### 5.10 反馈与报表
- 老师反馈工作台：`/admin/feedbacks`（查看、转发、代填草稿）
- 月度课时明细：`/admin/reports/monthly-hours`（导出 CSV）
- 月课表总览：`/admin/reports/monthly-schedule`（导出 CSV/PDF）

### 5.11 管理者模块
- 管理者驾驶舱：`/admin/manager`
- 系统使用者管理：`/admin/manager/users`
  - 用户增删改、重置密码、维护管理者名单（owner）。

---

## 6. 老师端功能说明（老师照着做）

### 6.1 总览 `/teacher`
- 今日课程、明日课程确认
- 快捷入口：名片维护

### 6.2 告警 `/teacher/alerts`
- 未签到、反馈超时的列表

### 6.3 可上课时间 `/teacher/availability`
- 按日期添加/批量添加/修改/删除
- 可清空整天
- 时间范围限制 08:00-23:00

### 6.4 课次 `/teacher/sessions`
- 按时间轴查看所有课次

### 6.5 课次详情 `/teacher/sessions/[id]`
- 点名保存
- 反馈提交（必填项未填会提示）

### 6.6 名片 `/teacher/card`
- 维护介绍并导出 PDF

---

## 7. 导出与PDF清单（对外/对账常用）

- 报名导出 PDF：`/admin/enrollments/export/pdf`
- 学生课表 PDF：`/api/exports/student-schedule/[id]`
- 学生详情 PDF：`/api/exports/student-detail/[id]`
- 课包对账单 PDF：`/api/exports/package-ledger/[id]`
- 选课链接月历 PDF：`/api/booking-links/[id]/export/pdf`
- 老师名片 PDF：管理端/老师端均可导出

---

## 8. 常见问题（员工最容易踩的坑）

### 8.1 报错：`Student has no active package for this course`
原因：学生没有该课程“当前有效”的课包。  
处理：学管去 `课包管理` 创建/续费 -> 再报名/排课。

### 8.2 报错：`No eligible teachers`
原因：没有老师同时满足“能教该课程 + 时间可用 + 无冲突”。  
处理顺序：
1. 检查老师授课能力（课程/级别）
2. 检查老师可上课时间（是否覆盖该时间段）
3. 检查冲突（到冲突中心看）

### 8.3 报错：`Outside availability`
原因：课次时间不在老师可用时间内（或超出 08:00-23:00）。  
处理：去可用时间页补齐/调整，再重新排课。

### 8.4 老师端看不到课次
原因：老师账号未绑定到老师档案，或排课时选错老师。  
处理：教务到 `老师详情` 做账号绑定并核对排课老师。

### 8.5 点名后扣费不对/对不上
排查顺序：
1. 课次点名页：点名状态、是否保存成功、是否回滚
2. 课包 ledger：对应课次的扣减记录是否存在
3. 学生是否存在多包重叠（学管检查）

---

## 9. 上线验收与培训

### 9.1 上线前验收（负责人抽样）
1. 能登录管理端与老师端
2. 能新建：校区/教室/课程/老师/学生
3. 能创建课包并在 ledger 看到记录
4. 能排课（班课/一对一）且不报冲突
5. 老师能点名并提交反馈
6. 抽样导出 PDF/CSV 可打开且中文不乱码

### 9.2 建议培训顺序（1-2小时完成）
1. 登录与语言切换（5分钟）
2. 待办中心 + 冲突处理（20分钟）
3. 学生详情 + 快速排课（20分钟）
4. 报名/课包规则（20分钟）
5. 选课链接与审批（15分钟）
6. 点名与反馈流程（15分钟）
7. 导出与复核（10分钟）

---

## 10. 附录：岗位SOP（可打印张贴）

### 10.1 教务排课SOP（摘要）
- 开工：待办中心清未点名 -> 冲突清零 -> 周课表改课 -> 新建单次补课
- 规则：必须在可用时间内，冲突统一在冲突中心闭环

### 10.2 学管SOP（摘要）
- 每天：续费预警 -> 学生详情核对 -> 建包/续费 -> 抽样对账

### 10.3 前台SOP（摘要）
- 每天：建档 -> 核对课包 -> 发选课链接 -> 跟进审批

### 10.4 老师SOP（摘要）
- 每天：确认课程 -> 维护可用时间 -> 课后点名 -> 12小时内反馈


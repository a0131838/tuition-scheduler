# 老师 + 教务 操作流程（详细版）

更新日期：2026-02-14  
适用系统：Tuition Scheduler（当前仓库版本）

## 1. 角色范围
- 教务（Admin）：负责排课、冲突处理、报名、课包、提醒、报表、老师/学生资料维护。
- 老师（Teacher）：负责维护可上课时间、确认今日/明日课程、课后点名与反馈。

## 2. 系统入口
- 教务入口：`/admin`
- 教务登录：`/admin/login`
- 老师入口：`/teacher`
- 初始化管理员（仅首启）：`/admin/setup`

## 3. 教务日常SOP（按时间顺序）

### 3.1 开工 10 分钟（先控风险）
1. 打开 ` /admin/todos `。
2. 优先清理“昨日/今日未点名”。
3. 查看冲突审计结果，有冲突直接进入 ` /admin/conflicts ` 处理。
4. 查看明日提醒（老师/学生）并确认状态。
5. 查看续费预警并分配跟进人。

标准：未点名、冲突两项必须先清零，再做新增排课。

### 3.2 排课与调课（核心）
涉及页面：
- ` /admin/schedule `（周课表主战场）
- ` /admin/schedule/new `（新建单次课/预约）
- ` /admin/conflicts `（冲突集中处置）

操作顺序：
1. 在 ` /admin/schedule ` 切换视图（老师/教室/校区）和周起始日期。
2. 先看冲突标记和低余额提示。
3. 对已有课次执行：
   - 换老师（session/appointment）
   - 删课（session/appointment）
4. 需要补课或临时加课时，进入 ` /admin/schedule/new ` 创建：
   - Create Session（班课）
   - Create Appointment（1对1预约）
5. 创建失败时，按错误信息回到 ` /admin/conflicts ` 处理后重试。

规则：
- 一切冲突以 ` /admin/conflicts ` 为统一处理口。
- 调整后要回到周课表复核目标老师/教室是否正确落位。

### 3.3 冲突中心闭环
页面：` /admin/conflicts `

每条冲突卡片建议按“先预约后课次”处理：
1. 先处理 appointment 冲突：
   - 改预约老师
   - 或取消预约
2. 再处理 session 冲突：
   - 改课次老师
   - 改班级教室（可按范围）
   - 取消课次
3. 操作后刷新卡片状态，确认冲突消失。

### 3.4 班级与报名
涉及页面：
- ` /admin/classes `
- ` /admin/classes/[id] `
- ` /admin/classes/[id]/sessions `
- ` /admin/enrollments `

标准流程：
1. 建班（课程/科目/级别/老师/校区/教室/容量）。
2. 学员报名入班（enrollment）。
3. 生成班级课次（按班级页或 sessions 页）。
4. 在周课表复核时间与老师。

### 3.5 学员与课包
涉及页面：
- ` /admin/students `
- ` /admin/students/[id] `
- ` /admin/packages `
- ` /admin/packages/[id]/ledger `

流程：
1. 学员建档（来源、类型、学校年级等）。
2. 创建/续费课包（按课程维度）。
3. 排课前先确认课包有效且余额足够。
4. 出现扣费争议时，先查课次点名，再查 ledger。

### 3.6 点名与反馈追踪
涉及页面：
- ` /admin/sessions/[id]/attendance `
- ` /admin/feedbacks `
- ` /admin/alerts `

流程：
1. 每日追踪未点名课次，督促老师补齐。
2. 查看反馈超时告警，督促老师在时限内提交。
3. 对异常记录留痕（备注原因、处理人、处理时间）。

### 3.7 收工 10 分钟（防次日爆雷）
1. 回 ` /admin/todos ` 看是否仍有未点名/冲突。
2. 明日提醒是否都已确认。
3. 续费预警是否已分配跟进。
4. 如当天做了大量调课，抽样复核 3-5 条记录（老师/教室/时间）。

## 4. 老师日常SOP（老师端）

### 4.1 上课前
涉及页面：
- ` /teacher `
- ` /teacher/availability `
- ` /teacher/alerts `

步骤：
1. 登录 ` /teacher ` 查看今日/明日课表。
2. 点击确认今日课程、明日课程（若页面提示未确认）。
3. 进入 ` /teacher/availability ` 维护可上课时间（建议至少滚动维护未来 2-4 周）。
4. 查看 ` /teacher/alerts `，处理未点名/反馈超时提醒。

### 4.2 上课后
涉及页面：
- ` /teacher/sessions `
- ` /teacher/sessions/[id] `

步骤：
1. 打开对应课次详情。
2. 完成点名（出勤/缺勤/请假等按实际填报）。
3. 提交课后反馈（按机构要求时限，建议当日完成）。

质量要求：
- 点名必须与真实出勤一致。
- 反馈至少包含课堂表现、作业情况、下节计划。

### 4.3 教师资料维护
涉及页面：
- ` /teacher/card `

步骤：
1. 维护老师介绍内容。
2. 导出名片PDF（对外展示时使用最新版本）。

## 5. 端到端协作流程（教务 + 老师）

### 5.1 新学员首课
1. 教务建档：` /admin/students `。
2. 教务建课包：` /admin/packages `。
3. 教务排课：` /admin/schedule/new ` 或学生详情快速排课。
4. 老师在 ` /teacher ` 确认课程。
5. 课后老师点名+反馈。
6. 教务抽查 ledger 与反馈质量。

### 5.2 调课/代课
1. 教务先到 ` /admin/conflicts ` 查看冲突面。
2. 先改 appointment，再改 session（避免反复冲突）。
3. 完成后回 ` /admin/schedule ` 验证结果。
4. 通知老师并要求老师端确认次日课程。

### 5.3 临时取消课程
1. 教务在 ` /admin/schedule ` 或 ` /admin/conflicts ` 取消课次/预约。
2. 同步通知老师和学生。
3. 检查点名与扣费是否保持一致（必要时在相关页面修正）。

## 6. 异常处理手册

### 6.1 常见报错与处理
1. `Student has no active package for this course`
- 原因：学员无该课程有效课包。
- 处理：先建/续课包，再报名/排课。

2. `No eligible teachers`
- 原因：没有满足“可教 + 可用 + 无冲突”的老师。
- 处理：检查老师授课能力、availability、冲突中心。

3. `Outside availability`
- 原因：课次超出老师可用时段。
- 处理：调整课次时间或先维护老师 availability。

### 6.2 数据异常排查顺序
1. 先看操作页是否成功返回。
2. 再看对应列表是否已刷新到最新状态。
3. 再查关联页面（课次、课包 ledger、冲突中心）。
4. 仍异常时记录：账号、时间、页面URL、操作步骤。

## 7. 每日执行清单（可直接照抄）

### 7.1 教务清单
- [ ] 打开 ` /admin/todos ` 清未点名
- [ ] 处理 ` /admin/conflicts ` 冲突
- [ ] 处理今日调课与新建课次
- [ ] 跟进续费预警
- [ ] 收工前复核明日提醒

### 7.2 老师清单
- [ ] 登录 ` /teacher ` 确认今日/明日课程
- [ ] 维护 ` /teacher/availability `
- [ ] 完成当日课次点名
- [ ] 提交课后反馈

## 8. 管理要求（建议落地）
- 所有调课以系统记录为准，不接受口头“已改但未落系统”。
- 冲突必须当天清零，未点名不得跨天堆积。
- 点名与反馈纳入老师质量考核。
- 每周固定抽检：
  - 课次随机抽检 20 条
  - 课包账务抽检 10 条
  - 冲突处理闭环抽检 10 条
